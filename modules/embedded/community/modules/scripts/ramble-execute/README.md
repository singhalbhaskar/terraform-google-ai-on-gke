## Description

This module will create a startup-script runner that will execute Ramble commands.

Ramble is a multi-platform experimentation framework capable of driving
software installation, acquiring input files, configuring experiments, and
extracting results. For more information about Ramble, see:
https://github.com/GoogleCloudPlatform/ramble

This module outputs a startup script runner, which can be combined with other
startup script runners to execute a set of Ramble commands.

Ramble makes extensive use of Spack. It must be installed with a Toolkit runner
generated by the [spack-setup module](../spack-setup/README.md) following the
[basic example](#basic-example) below.

> **_NOTE:_** This is an experimental module and the functionality and
> documentation will likely be updated in the near future. This module has only
> been tested in limited capacity.

# Examples

## Basic Example

Below is a basic example of using this module.

```yaml
  - id: spack
    source: community/modules/scripts/spack-setup

  - id: ramble-setup
    source: community/modules/scripts/ramble-setup

  - id: ramble-execute
    source: community/modules/scripts/ramble-execute
    use: [spack, ramble-setup]
    settings:
      commands:
      - ramble list
```

This example shows installing Spack and Ramble with their own modules
(spack-setup and ramble-setup respectively). Then the ramble-execute module
is added to simply list all applications Ramble knows about.

## License

<!-- BEGINNING OF PRE-COMMIT-TERRAFORM DOCS HOOK -->
## Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| commands | String of commands to run within this module | `string` | `null` | no |
| data\_files | A list of files to be transferred prior to running commands. <br>It must specify one of 'source' (absolute local file path) or 'content' (string).<br>It must specify a 'destination' with absolute path where file should be placed. | `list(map(string))` | `[]` | no |
| deployment\_name | Name of deployment, used to name bucket containing spack scripts. | `string` | n/a | yes |
| gcs\_bucket\_path | The GCS path for storage bucket and the object, starting with `gs://`. | `string` | n/a | yes |
| labels | Key-value pairs of labels to be added to created resources. | `map(string)` | n/a | yes |
| log\_file | Log file to write output from Ramble execute steps into | `string` | `"/var/log/ramble-execute.log"` | no |
| project\_id | Project in which the HPC deployment will be created. | `string` | n/a | yes |
| ramble\_profile\_script\_path | Path to the Ramble profile.d script. Created by an instance of ramble-setup.<br>Can be defined explicitly, or by chaining an instance of a ramble-setup module<br>through a `use` setting. | `string` | n/a | yes |
| ramble\_runner | Runner from previous ramble-setup or ramble-execute to be chained with scripts generated by this module. | <pre>object({<br>    type        = string<br>    content     = string<br>    destination = string<br>  })</pre> | n/a | yes |
| region | Region to place bucket containing spack scripts. | `string` | n/a | yes |
| spack\_profile\_script\_path | Path to the Spack profile.d script.<br>Can be defined explicitly, or by chaining an instance of a spack-setup module<br>through a `use` setting.<br>Defaults to /etc/profile.d/spack.sh if not set. | `string` | `"/etc/profile.d/spack.sh"` | no |
| system\_user\_name | Name of the system user used to execute commands. Generally passed from the ramble-setup module. | `string` | n/a | yes |

## Outputs

| Name | Description |
|------|-------------|
| controller\_startup\_script | Ramble startup script, duplicate for SLURM controller. |
| gcs\_bucket\_path | Bucket containing the startup scripts for ramble, to be reused by ramble-execute module. |
| ramble\_profile\_script\_path | Path to Ramble profile script. |
| ramble\_runner | Runner to execute Ramble commands using an ansible playbook. The startup-script module<br>will automatically handle installation of ansible. |
| spack\_profile\_script\_path | Path to Spack profile script. |
| startup\_script | Ramble startup script. |
| system\_user\_name | The system user used to execute commands. |

<!-- END OF PRE-COMMIT-TERRAFORM DOCS HOOK -->
